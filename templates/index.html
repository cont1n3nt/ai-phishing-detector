
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Phishing Detector</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white p-8 rounded shadow-md w-full max-w-lg">
    <h1 class="text-2xl font-bold mb-6 text-center">AI Phishing Detector</h1>

    <form id="predict-form" method="post">
      <label class="block mb-2 font-semibold">Paste Email Text:</label>
      <textarea name="text" rows="6" class="w-full p-2 border rounded mb-4" placeholder="Your email text here...">{{ request.form.text or '' }}</textarea>

      <label class="block mb-2 font-semibold">Threshold: <span id="threshold-value">{{ threshold or 0.4 }}</span></label>
      <input type="range" min="0" max="1" step="0.01" value="{{ threshold or 0.4 }}" class="w-full mb-4" id="threshold-slider" name="threshold">

      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full">Check</button>
    </form>

    <div id="result" class="mt-6 p-4 border rounded bg-gray-50 hidden"></div>

  </div>

<script>
  const slider = document.getElementById('threshold-slider');
  const output = document.getElementById('threshold-value');
  slider.oninput = function() {
    output.innerHTML = this.value;
  }

  const form = document.getElementById('predict-form');
  const resultDiv = document.getElementById('result');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = {
      text: formData.get("text"),
      threshold: parseFloat(formData.get("threshold"))
    };

    try {
      const res = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if (json.error) {
        resultDiv.innerHTML = `<p class="text-red-700 font-semibold">${json.error}</p>`;
      } else {
        let topWordsHTML = "";
        if(json.top_words) {
          topWordsHTML = "<p class='mt-2 font-semibold'>Top words contributing:</p><ul class='list-disc list-inside'>";
          json.top_words.forEach(w => {
            topWordsHTML += `<li>${w[0]} (${w[1].toFixed(3)})</li>`;
          });
          topWordsHTML += "</ul>";
        }

        resultDiv.innerHTML = `
          <p><span class="font-semibold">Prediction:</span> ${json.label}</p>
          <p><span class="font-semibold">Probability:</span> ${json.probability}</p>
          ${topWordsHTML}
        `;
      }
      resultDiv.classList.remove("hidden");
    } catch (err) {
      resultDiv.innerHTML = `<p class="text-red-700 font-semibold">Error: ${err}</p>`;
      resultDiv.classList.remove("hidden");
    }
  });
</script>

</body>
</html>
